syntax = "proto3";

package server.v1;

option go_package = "war-of-faith/pkg/protobuf/server/v1;serverv1";

import "google/protobuf/wrappers.proto";

message Village {
  uint32 id = 1;
  Resources resources = 2;
  repeated Building buildings = 3;
  repeated Troop troops = 4;
  repeated Troop.TrainingOrder troop_training_orders = 5;
}

message Resources {
  uint32 time = 1;
  uint32 gold = 2;
}

message Building {
  uint32 id = 1;
  Building.Kind kind = 2;
  string name = 3;
  uint32 level = 4;
  Building.UpgradeStatus upgrade_status = 5;
  uint32 upgrade_time_left = 6;
  Resources upgrade_cost = 7;

  enum Kind {
    KIND_UNSPECIFIED = 0;
    KIND_HALL = 1;
    KIND_GOLD_MINE = 2;
  }

  // TODO: Move this logic to the frontend
  enum UpgradeStatus {
    UPGRADE_STATUS_UNSPECIFIED = 0;
    UPGRADE_STATUS_UPGRADABLE = 1;
    UPGRADE_STATUS_UPGRADING = 2;
    UPGRADE_STATUS_MAX_LEVEL = 3;
    UPGRADE_STATUS_INSUFFICIENT_RESOURCES = 4;
  }
}

message Troop {
  uint32 id = 1;
  Troop.Kind kind = 2;
  string name = 3;
  Resources train_cost = 4;
  uint32 quantity = 5;

  enum Kind {
    KIND_UNSPECIFIED = 0;
    KIND_LEADER = 1;
  }

  message TrainingOrder {
    uint32 id = 1;
    uint32 quantity = 3;
    uint32 time_left = 4;
    Resources cost = 5;
    Troop troop = 6;
  }
}

// GetVillage
message GetVillageRequest {
  google.protobuf.UInt32Value id = 1;
}
message GetVillageResponse {
  Village Village = 1;
}

// UpgradeBuilding
message UpgradeBuildingRequest {
  uint32 id = 1;
}
message UpgradeBuildingResponse {
  Building building = 1;
}

// CancelUpgradeBuilding
message CancelUpgradeBuildingRequest {
  uint32 id = 1;
}
message CancelUpgradeBuildingResponse {
  Building building = 1;
}

// IssueTroopTrainingOrder
message IssueTroopTrainingOrderRequest {
  uint32 troop_id = 1;
  uint32 quantity = 2;
}
message IssueTroopTrainingOrderResponse {
  Troop.TrainingOrder order = 1;
}

// CancelTroopTrainingOrder
message CancelTroopTrainingOrderRequest {
  uint32 id = 1;
}
message CancelTroopTrainingOrderResponse {}

service Service {
  rpc GetVillage(GetVillageRequest) returns (GetVillageResponse);
  rpc UpgradeBuilding(UpgradeBuildingRequest) returns (UpgradeBuildingResponse);
  rpc CancelUpgradeBuilding(CancelUpgradeBuildingRequest) returns (CancelUpgradeBuildingResponse);
  rpc IssueTroopTrainingOrder(IssueTroopTrainingOrderRequest) returns (IssueTroopTrainingOrderResponse);
  rpc CancelTroopTrainingOrder(CancelTroopTrainingOrderRequest) returns (CancelTroopTrainingOrderResponse);
}