syntax = "proto3";

package server.v1;

option go_package = "war-of-faith/pkg/protobuf/server/v1;serverv1";

// import "google/protobuf/wrappers.proto";

message Village {
  uint32 id = 1;
  Resources resources = 2;
  repeated Building buildings = 3;
  repeated Building.UpgradeOrder building_upgrade_orders = 4;
  repeated Troop troops = 5;
  repeated Troop.TrainingOrder troop_training_orders = 6;
}

message Resources {
  uint32 time = 1;
  uint32 gold = 2;
}

message Building {
  uint32 id = 1;
  Building.Kind kind = 2;
  string name = 3;
  uint32 level = 4;

  enum Kind {
    KIND_UNSPECIFIED = 0;
    KIND_HALL = 1;
    KIND_GOLD_MINE = 2;
  }

  message UpgradeOrder {
    uint32 id = 1;
    uint32 level = 2;
    uint32 time_left = 3;
    Resources cost = 4;
    uint32 building_id = 5;
  }
}

message Troop {
  uint32 id = 1;
  Troop.Kind kind = 2;
  string name = 3;
  uint32 quantity = 4;

  enum Kind {
    KIND_UNSPECIFIED = 0;
    KIND_LEADER = 1;
  }

  message TrainingOrder {
    uint32 id = 1;
    uint32 quantity = 3;
    uint32 time_left = 4;
    Resources cost = 5;
    uint32 troop_id = 6;
  }
}

message World {
  uint32 width = 1;
  uint32 height = 2;
  repeated World.Cell cells = 3;

  message Cell {
    Coords coords = 1;
    World.Cell.EntityKind entity_kind = 2;
    uint32 entity_id = 3;

    enum EntityKind {
      ENTITY_KIND_UNSPECIFIED = 0;
      ENTITY_KIND_VILLAGE = 1;
      ENTITY_KIND_TEMPLE = 2;
    }
  }
}

message Temple {
  uint32 id = 1;
}

message Attack {
  uint32 id = 1;
  uint32 village_id = 2;
  Coords target_coords = 3;
  repeated Troop troops = 4;
  uint32 time_left = 5;
}

message Coords {
  uint32 x = 1;
  uint32 y = 2;
}

/* VILLAGES */
// GetVillage
message GetVillageRequest {
  uint32 id = 1;
}
message GetVillageResponse {
  Village Village = 1;
}

/* ORDERS */
// IssueBuildingUpgradeOrder
message IssueBuildingUpgradeOrderRequest {
  uint32 building_id = 1;
}
message IssueBuildingUpgradeOrderResponse {
  Building.UpgradeOrder order = 1;
}

// CancelBuildingUpgradeOrder
message CancelBuildingUpgradeOrderRequest {
  uint32 id = 1;
}
message CancelBuildingUpgradeOrderResponse {}

// IssueTroopTrainingOrder
message IssueTroopTrainingOrderRequest {
  uint32 troop_id = 1;
  uint32 quantity = 2;
}
message IssueTroopTrainingOrderResponse {
  Troop.TrainingOrder order = 1;
}

// CancelTroopTrainingOrder
message CancelTroopTrainingOrderRequest {
  uint32 id = 1;
}
message CancelTroopTrainingOrderResponse {}

/* WORLD */
// GetWorld
message GetWorldRequest {
  bool load_cells = 1;
}
message GetWorldResponse {
  World world = 1;
}

// Attack
message AttackRequest {
  Attack attack = 1;
}
message AttackResponse {
  Attack attack = 1;
}

service Service {
  /* VILLAGES */
  rpc GetVillage(GetVillageRequest) returns (GetVillageResponse);

  /* ORDERS */
  rpc IssueBuildingUpgradeOrder(IssueBuildingUpgradeOrderRequest) returns (IssueBuildingUpgradeOrderResponse);
  rpc CancelBuildingUpgradeOrder(CancelBuildingUpgradeOrderRequest) returns (CancelBuildingUpgradeOrderResponse);
  rpc IssueTroopTrainingOrder(IssueTroopTrainingOrderRequest) returns (IssueTroopTrainingOrderResponse);
  rpc CancelTroopTrainingOrder(CancelTroopTrainingOrderRequest) returns (CancelTroopTrainingOrderResponse);

  /* WORLD */
  rpc GetWorld(GetWorldRequest) returns (GetWorldResponse);
  rpc Attack(AttackRequest) returns (AttackResponse);
}